<?xml version='1.0' encoding='windows-1252'?>

<Wix xmlns='http://schemas.microsoft.com/wix/2006/wi'>
    <Product Name='OpenMS PD nodes' Manufacturer='OpenMS Team'
        Id='477329ad-a5a8-42f0-8114-7db495b978ce' 
        UpgradeCode='4843834a-e325-46c2-a782-ff0c38bab16a'
        Language='1033' Codepage='1252' Version='2.5.0'
		>
					
		<!-- elevated InstallPrivileges needed because we install into the Proteome Discoverer Folder -->
		<Package Id='*' 
			Keywords='Installer' 
			Description="OpenMS PD nodes Installer"
			InstallerVersion='300' 
			Languages='1033' 
			Compressed='yes' 
			SummaryCodepage='1252'
			InstallPrivileges="elevated"
			InstallScope="perMachine"
			/>
		
		<!-- For development purpose only. Allow to overwrite same version number. -->		
		<MajorUpgrade Schedule="afterInstallInitialize"
                DowngradeErrorMessage="A later version of [ProductName] is already installed"
                AllowSameVersionUpgrades="yes" />

		<Media Id="1" Cabinet="opennuxl.cab" EmbedCab="yes" CompressionLevel="medium" />

<!-- Set target directory to Proteome Discoverer Folder -->
		<CustomAction Id="SetTARGETDIR"
              Directory="TARGETDIR"
              Value="[ProgramFiles64Folder]\Thermo\Proteome Discoverer 2.5"
              Return="check" />
		<InstallExecuteSequence>
			<Custom Action="SetTARGETDIR" After="InstallValidate" />
		</InstallExecuteSequence>

<!-- Register nodes after installation -->
		<CustomAction Id="RegisterNodes" 
			Directory="TARGETDIR" 
			Execute="commit" 
			Impersonate="no" 
			ExeCommand="cmd.exe /c &quot;System/Release/Thermo.Magellan.Server -install&quot;" 
			Return="check" />
		<InstallExecuteSequence>
			<Custom Action="RegisterNodes" After="InstallInitialize" />
		</InstallExecuteSequence>

		<!-- Step 1: Define the directory structure -->
		<Directory Id='TARGETDIR' Name='SourceDir'>
			<Directory Id='PDSystemFiles' Name='System'>
				<Directory Id='PDSystemReleaseFiles' Name='Release'/>
			</Directory>
			<Directory Id='PDToolsFiles' Name='Tools'>
				<Directory Id='PDSystemReleaseNuXLFiles' Name='NuXL'>
					<Directory Id='PDSystemReleaseNuXLBinFiles' Name='bin' />
					<Directory Id='PDSystemReleaseNuXLShareFiles' Name='share'>
						<Directory Id='PDSystemReleaseNuXLShareOpenMSFiles' Name='OpenMS'>						
						</Directory>							
					</Directory>
				</Directory>
			</Directory>
		</Directory>
		
<!-- Step 2: Add node files to your installer package -->
		<DirectoryRef Id='PDSystemReleaseFiles'>
			<Component Id='OpenMSNode' Guid='245ddb1b-3166-41d7-b429-67b90a1920df'>
				<File Id='PD.OpenMS.AdapterNodes.dll' Name='PD.OpenMS.AdapterNodes.dll' Source='SourceDir\bin\PD.OpenMS.AdapterNodes.dll' KeyPath='yes' />
			</Component>
			<Component Id='ZedGraphDLL' Guid='79abf4d4-fe37-495c-8d96-c74a22465cb3'>
				<File Id='ZedGraph_OpenMS.dll' Name='ZedGraph_OpenMS.dll' Source='SourceDir\bin\ZedGraph_OpenMS.dll' KeyPath='yes' />
			</Component>
		</DirectoryRef>
		
		<DirectoryRef Id='PDSystemReleaseNuXLBinFiles'>
			<Component Id='OpenMSDLL' Guid='45eba75f-de71-4aec-a4fc-63f9843e2dca'>
				<File Id='OpenMS.dll' Name='OpenMS.dll' Source='SourceDir\bin\OpenMS.dll' KeyPath='yes' />
			</Component>
			<Component Id='OpenNuXLExe' Guid='62a9b8df-b548-4f7c-a760-870ecb3f62cf'>
				<File Id='OpenNuXL.exe' Name='OpenNuXL.exe' Source='SourceDir\bin\OpenNuXL.exe' KeyPath='yes' />
			</Component>
			<Component Id='Qt5Core' Guid='55eba75f-de71-4aec-a4fc-63f4843e2dca'>
				<File Id='Qt5Core.dll' Name='Qt5Core.dll' Source='SourceDir\bin\Qt5Core.dll' KeyPath='yes' />
			</Component>
			<Component Id='percolator' Guid='63f62d47-e8b5-47a3-a920-55c9bbb3245b'>
				<File Id='percolator.exe' Name='percolator.exe' Source='SourceDir\bin\percolator.exe' KeyPath='yes' />
			</Component>								
		</DirectoryRef>
		
<!-- Step 3: Tell WiX to install the files -->		
		<Feature Id='Complete' Level='1'>
			<ComponentRef Id='OpenMSNode' />
			<ComponentRef Id='ZedGraphDLL' />
			<ComponentRef Id='OpenMSDLL' />
			<ComponentRef Id='OpenNuXLExe' />
			<ComponentRef Id='percolator' />
<!-- This will include the heat generated components (both wix files need to be passed to candle) -->		
			<ComponentGroupRef Id='OpenMSShareComponents' />
		</Feature>	
		
    </Product>
</Wix>
